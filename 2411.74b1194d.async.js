"use strict";(self.webpackChunk_hocgin_ui=self.webpackChunk_hocgin_ui||[]).push([[2411],{2411:function(K,m,o){o.r(m);var f=o(9189),E=o.n(f),P=o(58482),C=o.n(P),M=o(93275),_=o.n(M),u=o(43906),g=o(51762),c=o(12910),O=o(47099),d=o.n(O),D=o(12162),R=o.n(D),p=o(7571),U=o.n(p),A=o(78138),W=o.n(A),B=o(78809),T=o.n(B),L=o(4309),S=o.n(L),y=o(57055),w=o.n(y),b=o(56463),x=o(86508),I=function(){function s(r,e,t,n){var i=this;E()(this,s),_()(this,"node",void 0),_()(this,"view",void 0),_()(this,"schema",void 0),_()(this,"cm",void 0),_()(this,"dom",void 0),_()(this,"getPos",void 0),_()(this,"updating",void 0),_()(this,"incomingChanges",void 0),this.node=r,this.view=e,this.schema=r.type.schema,this.getPos=t,this.updating=!1,this.incomingChanges=!1,this.cm=d()(null,{value:r.textContent,lineNumbers:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseTags:!0,mode:n,readOnly:!e.editable}),this.dom=this.cm.getWrapperElement(),setTimeout(function(){return i.cm.refresh()},50),this.cm.on("beforeChange",function(){return i.incomingChanges=!0}),this.cm.on("cursorActivity",function(){!i.updating&&!i.incomingChanges&&i.forwardSelection(),i.cm.setOption("readOnly",!i.view.editable)}),this.cm.on("changes",function(){i.updating||(i.valueChanged(),i.forwardSelection()),i.incomingChanges=!1}),this.cm.on("focus",function(){return i.forwardSelection()})}return C()(s,[{key:"forwardSelection",value:function(){if(!!this.cm.hasFocus()){console.log("this.view",this.view);var e=this.view.state,t=this.asProseMirrorSelection(e.doc);t.eq(e.selection)||this.view.dispatch(e.tr.setSelection(t))}}},{key:"asProseMirrorSelection",value:function(e){var t=this.getPos()+1,n=this.cm.indexFromPos(this.cm.getCursor("anchor"))+t,i=this.cm.indexFromPos(this.cm.getCursor("head"))+t;return u.Bs.create(e,n,i)}},{key:"valueChanged",value:function(){var e=v(this.node.textContent,this.cm.getValue());if(!!e){var t=this.getPos()+1,n=this.view.state.tr.replaceWith(t+e.from,t+e.to,e.text?this.schema.text(e.text):[]);this.view.dispatch(n)}}},{key:"codeMirrorKeymap",value:function(){var e,t=this,n,i=this.view,l=typeof window!="undefined"&&typeof navigator!="undefined"?(e=navigator)===null||e===void 0?void 0:e.platform:"",h=/Mac/.test(l)?"Cmd":"Ctrl";return d().normalizeKeyMap((n={Up:function(){return t.maybeEscape("line",-1)},Left:function(){return t.maybeEscape("char",-1)},Down:function(){return t.maybeEscape("line",1)},Right:function(){return t.maybeEscape("char",1)},"Ctrl-Enter":function(){(0,g.uo)(i.state,i.dispatch)&&i.focus()}},_()(n,"".concat(h,"-Z"),function(){return(0,c.Yw)(i.state,i.dispatch)}),_()(n,"Shift-".concat(h,"-Z"),function(){return(0,c.KX)(i.state,i.dispatch)}),_()(n,"".concat(h,"-Y"),function(){return(0,c.KX)(i.state,i.dispatch)}),n))}},{key:"maybeEscape",value:function(e,t){var n=this.cm.getCursor();if(this.cm.somethingSelected()||n.line!=(t<0?this.cm.firstLine():this.cm.lastLine())||e=="char"&&n.ch!=(t<0?0:this.cm.getLine(n.line).length))return d().Pass;this.view.focus();var i=this.getPos()+(t<0?0:this.node.nodeSize),l=u.Y1.near(this.view.state.doc.resolve(i),t);return this.view.dispatch(this.view.state.tr.setSelection(l).scrollIntoView()),this.view.focus(),null}},{key:"update",value:function(e){if(e.type!==this.node.type)return!1;this.node=e;var t=v(this.cm.getValue(),e.textContent);return t&&(this.updating=!0,this.cm.replaceRange(t.text,this.cm.posFromIndex(t.from),this.cm.posFromIndex(t.to)),this.updating=!1),!0}},{key:"setSelection",value:function(e,t){console.log("CodeBlockView - setSelection"),this.cm.focus(),this.updating=!0,this.cm.setSelection(this.cm.posFromIndex(e),this.cm.posFromIndex(t)),this.updating=!1}},{key:"selectNode",value:function(){console.log("CodeBlockView - selectNode"),this.cm.focus()}},{key:"stopEvent",value:function(){return!0}}]),s}();function v(s,r){if(s===r)return null;for(var e=0,t=s.length,n=r.length;e<t&&s.charCodeAt(e)===r.charCodeAt(e);)++e;for(;t>e&&n>e&&s.charCodeAt(t-1)===r.charCodeAt(n-1);)t--,n--;return{from:e,to:t,text:r.slice(e,n)}}m.default=I}}]);
